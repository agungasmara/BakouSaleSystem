<template>
	<v-app id="inspire">
		<!--breadcrumbs start-->
			<breadcrumb3button
			v-bind:breadcrumb-item="breadcrumbs"
			v-bind:breadcrumb-title="breadcrumbTitle"
			v-bind:submit="submit"
			v-bind:is-valid="valid"
			v-bind:back-url="backUrl"
			></breadcrumb3button>
		<!--breadcrumbs end-->
		<v-form v-model="valid" ref="form" lazy-validation>
	      	<v-card flat>
	        	<v-card-text>
	        		<v-container grid-list-md offset-s3>
	          			<v-layout wrap>
	          				<v-flex v-for="input in formItems" :key="input.key" :class="input.class">
		      					<div v-if="input.type=='select'">
									<v-select :label="input.text"  :rules="formRules[input.key]" v-model="formDatas[input.key]" :items="selectItems[input.items]" required></v-select>
		      					</div>
		      					<div v-if="input.type=='image'">
									<input type="file" id="fileInput"  style="display:none" ref="fileInput" accept="image/*" @change="onFilePicked">
									<v-layout align-center justify-center >
										<div>
											<v-badge color="indigo" v-if="imageUrl">
												<span slot="badge" style="cursor:pointer;" @click="clearImage">
													x
												</span>
											</v-badge>
											<label for="fileInput">
												<img  :src="imageUrl" height="100" style="height:100px; max-width: 300px; cursor:pointer; margin-top: -30px;" @click="onPickFile">
											
												<div v-if="!imageUrl" height="100" style="height:100px; max-width: 300px; cursor:pointer; margin-top: -30px;">
													<v-alert outline color="info" :value="true" @click="onPickFile">{{ btnText }}
													</v-alert>
												</div>
											</label>
										</div>
									</v-layout>
								</div>
								<div v-if="input.type=='password'">
									<v-text-field  label="Confirm Password" v-model="formDatas[input.key]" name="confirmpassword" :rules="formRules[input.key]" required :append-icon="e1 ? 'visibility' : 'visibility_off'" :append-icon-cb="() => (e1 = !e1)" :type="e1 ? 'password' : 'text'"></v-text-field>
								</div>
		      					<div v-if="input.type=='text'">
									<v-text-field :label="input.text" :rules='formRules[input.key]' v-model="formDatas[input.key]" :counter="input.count" required></v-text-field>
		      					</div>
		      				</v-flex>
					    </v-layout>
					</v-container>
	        	</v-card-text>
	      	</v-card>
	    </v-form>
	</v-app>
</template>
<script>
	import Flash from '../../../../../helper/flash'
	import axios from 'axios'
	import breadcrumb3button from '../breadcrumb/breadcrumb3button.vue'
	export default{
		props:[
			'id',
			'breadcrumbTitle',
			'breadcrumbs',
			'formItems',
			'formRules',
			'formDatas',
			'selectItems',
			'url',
			'backUrl'
		],
		components:{
			'breadcrumb3button':breadcrumb3button
		},
		data(){
			return{
				e1:true,
				count:0,
				valid:true,
				btnImageDisabled:false,
				btnText:'Upload Image',
				imageUrl:'',
				image:null,
			}
		},
		methods:{
			submit (opt) {
		      	if (this.$refs.form.validate()) {
			        // Native form submission is not yet supporte
			        console.log(this.formDatas)
			        if(this.id==0){
			        	axios.post(this.url,{
				          data:this.formDatas
				        }).then((res)=>{
				        	console.log(res.data)
				        	if(res.data.success==true){
				        		Flash.setSuccess(res.data.message)
				        		if(opt==2){
				        			this.$router.push(backUrl)
				        		}
				        	}
				        })
			        }else{
			        	axios.put(this.url+this.id, {
				          data:this.formDatas
				        }).then((res)=>{
				        	if(res.data.success==true){
				        		Flash.setSuccess(res.data.message)
				        		if(opt==2){
				        			this.$router.push(backUrl)
				        		}
				        	}
				        })
			        }
			        
		      	}
		    },
			onPickFile() {
				

		    	this.btnImageDisabled=true
		    	this.btnText="Uploading..."
		        
		    },
		    onFilePicked(event){
		    	
		    	this.image=this.imageUrl
		    	const files=event.target.files
		    	let filename=files[0].name;
		    	if(filename.lastIndexOf('.')<=0){
		    		return alert('Please add a valid file!')
		    	}
		    	const fileReader=new FileReader()
		    	fileReader.addEventListener('load',()=>{
		    		
		    		this.imageUrl=fileReader.result
					this.btnImageDisabled=false
		    		this.btnText="Upload Image"
		    	
		    	})
		    	fileReader.readAsDataURL(files[0])
		    	
		    },
		    clearImage(){
		    	this.imageUrl=''
		    	const input = this.$refs.fileInput
		    	input.reset()
		    }
		}
	}
</script>